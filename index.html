<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Analysis & Ad Preview</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* This ensures the image or video fills the aspect ratio box */
        #media-wrapper img,
        #media-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.5rem; /* rounded-lg */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans p-4 sm:p-8">

    <main class="max-w-7xl mx-auto">
    
        <!-- --- Top Section: Campaign Analysis (from your screenshot) --- -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl mb-8 sm:mb-12">
            <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 text-gray-800">Campaign Analysis & New Ad Concepts</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8">
                
                <!-- Best Performing Copy -->
                <div>
                    <h2 class="text-xl font-semibold mb-3">Best Performing Copy (by CTR & CPC)</h2>
                    <p class="text-sm text-gray-600 mb-4">(Note: Conversion data was not broken down by copy, so CTR and CPC are our best metrics for engagement.)</p>
                    <div class="space-y-3 text-gray-700">
                        <div>
                            <strong class="font-medium">Best Headlines:</strong>
                            <ul class="list-disc list-inside ml-4 text-sm">
                                <li>"PLAN. TRAIN. SUCCEED." (4.81% CTR, 1.56 NOK CPC)</li>
                                <li>"Try for 14 days" (4.75% CTR, 1.71 NOK CPC)</li>
                            </ul>
                        </div>
                        <div>
                            <strong class="font-medium">Best Primary Text:</strong>
                            <ul class="list-disc list-inside ml-4 text-sm">
                                <li>"Get access to our coaching platform for Handball w..." (5.12% CTR, 1.76 NOK CPC)</li>
                                <li>"The video exercises the pros use, now available fo..." (4.25% CTR, 2.10 NOK CPC)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Strategy for New Ads -->
                <div>
                    <h2 class="text-xl font-semibold mb-3">Strategy for New Ads</h2>
                    <p class="text-sm text-gray-700 leading-relaxed">
                        This data shows our converting audience is **Males 35-54+**. This is the "parent coach" or "dad coach" demographic.
                    </p>
                    <p class="text-sm text-gray-700 leading-relaxed mt-3">
                        Our winning ads focused on platform features. These new concepts are designed to test completely new emotional angles and value propositions that will resonate directly with this specific audience, while following Atle's feedback (clear hook, bullets, CTA button).
                    </p>
                </div>
            </div>
        </div>

        <!-- --- Bottom Section: New Ad Concept Canvas --- -->
        <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 text-gray-800">New Ad Concept Canvas</h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
            
            <!-- Column 1: Ad Controls -->
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl lg:h-fit">
                <h3 class="text-xl font-semibold mb-5">Ad Controls</h3>
                
                <!-- Load New Concept Dropdown -->
                <div class="mb-5">
                    <label for="concept-select" class="block text-sm font-medium text-gray-600 mb-2">Load New Concept</label>
                    <select id="concept-select" class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option>1. "The 'Dad Coach' Persona"</option>
                        <!-- Add other concepts here as <option> tags -->
                    </select>
                </div>

                <!-- Aspect Ratio Buttons -->
                <div class="mb-5">
                    <label class="block text-sm font-medium text-gray-600 mb-2">Aspect Ratio</label>
                    <div class="flex gap-4">
                        <button id="btn-4-5" class="aspect-btn flex-1 px-4 py-3 rounded-lg font-medium transition-colors">4:5</button>
                        <button id="btn-9-16" class="aspect-btn flex-1 px-4 py-3 rounded-lg font-medium transition-colors">9:16</button>
                    </div>
                </div>

                <!-- Image URL Input -->
                <div class="mb-5">
                    <label for="link-input" class="block text-sm font-medium text-gray-600 mb-2">Image URL</label>
                    <input type="text" id="link-input" placeholder="Paste a link (Google Drive, imgur, etc.)" class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p id="error-msg" class="text-red-500 text-sm mt-1 h-4"></p>
                </div>

                <!-- Logo URL Input -->
                <div>
                    <label for="logo-input" class="block text-sm font-medium text-gray-600 mb-2">Logo URL</label>
                    <input type="text" id="logo-input" placeholder="Paste logo URL (optional)" class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>

            <!-- Column 2-3: Preview Area -->
            <div class="lg:col-span-2 bg-gray-800 p-4 sm:p-6 rounded-2xl shadow-xl flex items-center justify-center min-h-[400px] lg:min-h-[600px]">
                <div id="media-wrapper" class="bg-gray-700 rounded-lg w-full transition-all duration-300">
                    <p id="placeholder-text" class="text-gray-400 text-center p-10">Preview will appear here</e>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Get all the necessary elements from the page
        const linkInput = document.getElementById('link-input');
        const mediaWrapper = document.getElementById('media-wrapper');
        const placeholderText = document.getElementById('placeholder-text');
        const errorMsg = document.getElementById('error-msg');
        
        const btn4to5 = document.getElementById('btn-4-5');
        const btn9to16 = document.getElementById('btn-9-16');
        const aspectButtons = [btn4to5, btn9to16];

        let currentAspectRatio = 'aspect-[4/5]'; // Default aspect ratio

        /**
         * Converts a Google Drive sharing link into a direct embeddable link.
         * @param {string} url - The original Google Drive sharing URL
         * @returns {string} - The direct media URL
         */
        function convertGoogleDriveLink(url) {
            let fileId = null;
            
            // Regex to find the File ID in common Google Drive link formats
            const regex = /\/d\/(.*?)(?:\/view|\?usp|$)/;
            const match = url.match(regex);
            
            if (match && match[1]) {
                fileId = match[1];
                // Use the 'uc' (user content) link for direct embedding
                return `https://drive.google.com/uc?id=${fileId}`;
            }
            
            // If it's not a matching Google Drive link, return the original URL
            return url;
        }

        /**
         * Updates the active state of aspect ratio buttons
         */
        function updateActiveButton(activeButton) {
            aspectButtons.forEach(button => {
                if (button === activeButton) {
                    button.classList.add('bg-blue-600', 'text-white');
                    button.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    button.classList.remove('bg-blue-600', 'text-white');
                    button.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
        }
        
        /**
         * Generates the media preview
         */
        function generatePreview() {
            let url = linkInput.value.trim();
            if (!url) {
                // If input is empty, show placeholder and clear error
                mediaWrapper.innerHTML = '';
                placeholderText.style.display = 'block';
                mediaWrapper.appendChild(placeholderText);
                mediaWrapper.classList.remove('aspect-[4/5]', 'aspect-[9/16]');
                errorMsg.textContent = '';
                return;
            }

            // Convert the link if it's from Google Drive
            const mediaUrl = convertGoogleDriveLink(url);

            // Clear the wrapper and hide placeholder
            mediaWrapper.innerHTML = '';
            placeholderText.style.display = 'none';
            errorMsg.textContent = '';
            
            // Apply the currently selected aspect ratio
            mediaWrapper.classList.remove('aspect-[4/5]', 'aspect-[9/16]');
            mediaWrapper.classList.add(currentAspectRatio);

            // Determine if it's an image or video
            const isImage = /\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(mediaUrl.split('?')[0]);
            const isVideo = /\.(mp4|mov|webm|ogg)$/i.test(mediaUrl.split('?')[0]);
            
            // This is the error handling function
            const handleError = () => {
                mediaWrapper.innerHTML = ''; // Clear any broken elements
                mediaWrapper.classList.remove(currentAspectRatio); // Remove aspect ratio styling
                errorMsg.textContent = 'Error loading media. Check link or permissions.';
                placeholderText.style.display = 'block'; // Show placeholder
                mediaWrapper.appendChild(placeholderText);
            };

            if (isImage || (url.includes('drive.google.com') && !isVideo)) {
                // Assume Google Drive link is an image if not obviously a video
                const img = document.createElement('img');
                img.src = mediaUrl;
                img.alt = 'Media Preview';
                img.onerror = handleError;
                mediaWrapper.appendChild(img);
            } else if (isVideo) {
                const video = document.createElement('video');
                video.src = mediaUrl;
                video.controls = true;
                video.autoplay = true;
                video.muted = true;
                video.playsInline = true;
                video.loop = true;
                video.onerror = handleError;
                mediaWrapper.appendChild(video);
            } else {
                // Fallback for GDrive links or other types
                const img = document.createElement('img');
                img.src = mediaUrl;
                img.alt = 'Media Preview';
                img.onerror = handleError;
                mediaWrapper.appendChild(img);
            }
        }

        // --- Event Listeners ---

        // Handle 4:5 button click
        btn4to5.addEventListener('click', () => {
            currentAspectRatio = 'aspect-[4/5]';
            updateActiveButton(btn4to5);
            generatePreview(); // Re-generate preview with new aspect ratio
        });

        // Handle 9:16 button click
        btn9to16.addEventListener('click', () => {
            currentAspectRatio = 'aspect-[9:16]';
            updateActiveButton(btn9to16);
            generatePreview(); // Re-generate preview with new aspect ratio
        });

        // Handle link input (triggers on paste, type, delete)
        linkInput.addEventListener('input', generatePreview);

        // Set initial button state on load
        updateActiveButton(btn4to5);
    </script>

</body>
</html>

